<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quiz n·ªôi b·ªô</title>
<style>
/* CSS y h·ªát m·∫´u tr∆∞·ªõc */
body{font-family:Arial;background:#eef2f6}
.box{max-width:720px;margin:40px auto;background:#fff;padding:25px;border-radius:10px}
input{width:100%;padding:10px;margin:8px 0}
button{padding:10px 16px;background:#0a58ca;color:#fff;border:0;border-radius:5px}
.progress{background:#ddd;height:8px;border-radius:5px;margin:10px 0}
.bar{background:#0a58ca;height:100%;width:0%}
.timer{text-align:right;font-weight:bold}
.header{text-align:center;margin-bottom:10px}
#a{display:flex;flex-direction:column;gap:12px;margin-top:12px;}
.option{display:flex;align-items:flex-start;gap:12px;padding:14px 16px;border:1px solid #ddd;border-radius:12px;background:#fff;cursor:pointer;transition:.2s;}
.option:hover{background:#f5f9ff;border-color:#0d6efd;}
.option input{display:none;}
.radio{width:18px;height:18px;border:2px solid #999;border-radius:50%;margin-top:4px;flex-shrink:0;position:relative;}
.option input:checked + .radio{border-color:#0d6efd;}
.option input:checked + .radio::after{content:"";width:10px;height:10px;background:#0d6efd;border-radius:50%;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);}
.content{font-size:15px;line-height:1.45;}
.option input:checked ~ .content{font-weight:600;color:#0d6efd;}
@media(max-width:600px){.option{padding:16px;}.content{font-size:14px;}}
</style>
</head>
<body>
<div class="header">
  <h2>B√ÄI THI N·ªòI B·ªò</h2>
</div>

<div class="box" id="start">
<input id="name" placeholder="H·ªç t√™n">
<input id="code" placeholder="M√£ nh√¢n vi√™n">
<button onclick="start()">B·∫Øt ƒë·∫ßu thi</button>
</div>

<div class="box" id="quiz" style="display:none">
<div class="timer" id="timer"></div>
<div class="progress"><div class="bar" id="bar"></div></div>
<h3 id="q"></h3>
<div id="a"></div>
<button onclick="next()">C√¢u ti·∫øp</button>
</div>

<div class="box" id="end" style="display:none">
<h2>K·∫æT QU·∫¢</h2>
<div id="result"></div>
</div>

<script>
const SCRIPT_GET="YOUR_WEB_APP_URL?callback=onQuestions";
const SCRIPT_POST="YOUR_WEB_APP_URL";

const TOTAL_QUESTIONS=3;
const EXAM_TIME=600;

const startBox=document.getElementById("start");
const quizBox=document.getElementById("quiz");
const endBox=document.getElementById("end");
const nameEl=document.getElementById("name");
const codeEl=document.getElementById("code");
const timerEl=document.getElementById("timer");
const bar=document.getElementById("bar");
const qEl=document.getElementById("q");
const aEl=document.getElementById("a");
const result=document.getElementById("result");

let questionBank=[],questions=[],index=0,score=0,time=EXAM_TIME,timer,user={};

function shuffle(a){return a.sort(()=>Math.random()-0.5)}

function loadQuestions(){
 return new Promise(resolve=>{
  window.onQuestions=d=>resolve(d);
  const s=document.createElement("script");
  s.src=SCRIPT_GET;
  document.body.appendChild(s);
 });
}

async function start(){
 if(!nameEl.value||!codeEl.value) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin");
 user={name:nameEl.value,code:codeEl.value};
 questionBank=await loadQuestions();
 questions = shuffle([...questionBank]).slice(0,TOTAL_QUESTIONS);
 startBox.style.display="none";
 quizBox.style.display="block";
 tick(); load();
}

function tick(){timer=setInterval(()=>{timerEl.innerText="‚è±Ô∏è "+time--;if(time<=0) finish();},1000);}

function load(){
 bar.style.width = (index/questions.length*100)+"%";
 qEl.innerText=`C√¢u ${index+1}: ${questions[index].q}`;
 aEl.innerHTML="";
 const opts=shuffle(questions[index].a.map((t,i)=>({t,i})));
 questions[index].correctIndex=questions[index].c;
 opts.forEach((o,i)=>{
   aEl.innerHTML+=`<label class="option">
     <input type="radio" name="ans" value="${i}">
     <span class="radio"></span>
     <span class="content"><b>${String.fromCharCode(65+i)}.</b> ${o.t}</span>
   </label>`;
 });
 questions[index].opts=opts;
}

function next(){
 const c=document.querySelector("input[name=ans]:checked");
 if(!c) return alert("Ch·ªçn ƒë√°p √°n");
 const selectedIndex = +c.value;
 const correctIndex = questions[index].opts.findIndex(o=>o.i===questions[index].correctIndex);
if(selectedIndex===correctIndex) score++;
 index++;
 index<questions.length?load():finish();
}

function finish(){
 clearInterval(timer);
 quizBox.style.display="none";
 endBox.style.display="block";
const pass = score>=Math.ceil(questions.length*0.7);
sendResult(pass);
result.innerHTML=`üë§ ${user.name}<br>üÜî ${user.code}<br>ƒêi·ªÉm: ${score}/${questions.length}<br><b style="color:${pass?'green':'red'}">${pass?'PASS':'FAIL'}</b>`;
}

function sendResult(pass){
 const params=new URLSearchParams({
   name:user.name,
   code:user.code,
   score:score,
   total:questions.length,
   result:pass?'PASS':'FAIL',
   _ts:Date.now()
 });
 fetch(SCRIPT_POST+"?"+params.toString())
  .then(res=>res.json())
  .then(data=>{
    if(data.status==="success" && data.certUrl){
      result.innerHTML+=`<br>üìÑ <a href="${data.certUrl}" target="_blank">T·∫£i ch·ª©ng ch·ªâ PDF</a>`;
    }
  });
}
</script>
</body>
</html>
