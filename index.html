<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>B√ÄI THI ƒê√ÄO T·∫†O N·ªòI B·ªò</title>
<style>
body{font-family:Arial;background:#eef2f6}
.box{max-width:720px;margin:40px auto;background:#fff;padding:25px;border-radius:10px}
input{width:100%;padding:10px;margin:8px 0}
button{padding:10px 16px;background:#0a58ca;color:#fff;border:0;border-radius:5px}
.progress{background:#ddd;height:8px;border-radius:5px;margin:10px 0}
.bar{background:#0a58ca;height:100%;width:0%}
.timer{text-align:right;font-weight:bold}
.header{text-align:center;margin-bottom:10px}
/* Kh·ªëi ƒë√°p √°n */
#a{
  display:flex;
  flex-direction:column;
  gap:12px;
  margin-top:12px;
}

/* Card ƒë√°p √°n */
.option{
  display:flex;
  align-items:flex-start;
  gap:12px;
  padding:14px 16px;
  border:1px solid #ddd;
  border-radius:12px;
  background:#fff;
  cursor:pointer;
  transition:.2s;
}

/* Hover */
.option:hover{
  background:#f5f9ff;
  border-color:#0d6efd;
}

/* ·∫®n radio g·ªëc */
.option input{
  display:none;
}

/* Radio custom */
.radio{
  width:18px;
  height:18px;
  border:2px solid #999;
  border-radius:50%;
  margin-top:4px;
  flex-shrink:0;
  position:relative;
}

/* Khi ch·ªçn */
.option input:checked + .radio{
  border-color:#0d6efd;
}

.option input:checked + .radio::after{
  content:"";
  width:10px;
  height:10px;
  background:#0d6efd;
  border-radius:50%;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}

/* N·ªôi dung */
.content{
  font-size:15px;
  line-height:1.45;
}

/* Tr·∫°ng th√°i ch·ªçn */
.option input:checked ~ .content{
  font-weight:600;
  color:#0d6efd;
}

/* Mobile t·ªëi ∆∞u */
@media(max-width:600px){
  .option{
    padding:16px;
  }
  .content{
    font-size:14px;
  }
}
</style>
</head>
<body>

<div class="header">
  <img src="logo.png" height="70">
  <h2>B√ÄI THI ƒê√ÄO T·∫†O N·ªòI B·ªò</h2>
</div>

<div class="box" id="start">
<input id="name" placeholder="H·ªç t√™n">
<input id="code" placeholder="M√£ nh√¢n vi√™n">
<button onclick="start()">B·∫Øt ƒë·∫ßu thi</button>
</div>

<div class="box" id="quiz" style="display:none">
<div class="timer" id="timer"></div>
<div class="progress"><div class="bar" id="bar"></div></div>
<h3 id="q"></h3>
<div id="a"></div>
<button onclick="next()">C√¢u ti·∫øp</button>
</div>

<div class="box" id="end" style="display:none">
<h2>K·∫æT QU·∫¢</h2>
<div id="result"></div>
</div>

<script>
const SCRIPT_GET = "https://script.google.com/macros/s/AKfycbwjbcZX3uecL6S4vFVv68kImKsaXXgx0FSOclLD-4smrhEFAtEj88es-4Rg6bqJtuHdYQ/exec?callback=onQuestions";
const SCRIPT_POST = "https://script.google.com/macros/s/AKfycbwjbcZX3uecL6S4vFVv68kImKsaXXgx0FSOclLD-4smrhEFAtEj88es-4Rg6bqJtuHdYQ/exec";

const TOTAL_QUESTIONS=3;
const PASS_SCORE=14;
const EXAM_TIME=1200;

const startBox=document.getElementById("start");
const quizBox=document.getElementById("quiz");
const endBox=document.getElementById("end");
const nameEl=document.getElementById("name");
const codeEl=document.getElementById("code");
const timerEl=document.getElementById("timer");
const bar=document.getElementById("bar");
const qEl=document.getElementById("q");
const aEl=document.getElementById("a");
const result=document.getElementById("result");

let questionBank=[],questions=[],index=0,score=0,time=EXAM_TIME,timer,user={};

function shuffle(a){return a.sort(()=>Math.random()-0.5)}

function loadQuestions(){
 return new Promise(resolve=>{
  window.onQuestions=d=>resolve(d);
  const s=document.createElement("script");
  s.src=SCRIPT_GET;
  document.body.appendChild(s);
 });
}

async function start(){
 if(!nameEl.value||!codeEl.value) return alert("Nh·∫≠p ƒë·ªß th√¥ng tin");
 user={name:nameEl.value,code:codeEl.value};
 questionBank=await loadQuestions();
 prepare();
 startBox.style.display="none";
 quizBox.style.display="block";
 tick(); load();
}

function prepare(){
  questions = shuffle([...questionBank])
    .slice(0, TOTAL_QUESTIONS)
    .map(q => {

      // üîë L·ªåC ƒê√ÅP √ÅN R·ªñNG
      let answers = q.a.filter(
        x => x !== null && x !== undefined && x.toString().trim() !== ""
      );

      let opts = answers.map((t,i)=>({t,i}));
      opts = shuffle(opts);

      return {
        q: q.q,
        opts,
        correct: opts.findIndex(o => o.i === q.c)
      };
    });
}

function tick(){
 timer=setInterval(()=>{
  timerEl.innerText="‚è±Ô∏è "+time--;
  if(time<=0) finish();
 },1000);
}

function load(){
  bar.style.width = (index / questions.length * 100) + "%";
  q.innerText = `C√¢u ${index + 1}: ${questions[index].q}`;
  a.innerHTML = "";

  questions[index].opts.forEach((o,i)=>{
    a.innerHTML += `
      <label class="option">
        <input type="radio" name="ans" value="${i}">
        <span class="radio"></span>
        <span class="content">
          <b>${String.fromCharCode(65+i)}.</b> ${o.t}
        </span>
      </label>
    `;
  });
}

function next(){
 const c=document.querySelector("input[name=ans]:checked");
 if(!c) return alert("Ch·ªçn ƒë√°p √°n");
 if(+c.value===questions[index].correct) score++;
 index++;
 index<questions.length?load():finish();
}

function finish(){
  clearInterval(timer);
  quizBox.style.display="none";
  endBox.style.display="block";

  //Pass = s·ªë ƒëi·ªÉm const pass = score >= PASS_SCORE;
  //Pass = ‚â• 70% s·ªë c√¢u
  const pass = score >= Math.ceil(questions.length * 0.7);
  sendResult(pass);

  result.innerHTML = `
    üë§ ${user.name}<br>
    üÜî ${user.code}<br>
    ƒêi·ªÉm: ${score}/${TOTAL_QUESTIONS}<br>
    <b style="color:${pass?'green':'red'}">
      ${pass ? 'PASS' : 'FAIL'}
    </b>
  `;
}
  function sendResult(pass){
  const params = new URLSearchParams({
    name: user.name,
    code: user.code,
    score: score,
    total: TOTAL_QUESTIONS,
    result: pass ? "PASS" : "FAIL"
  });

  // üî• B·∫ÆT BU·ªòC: ch·ªëng cache
  params.append("_ts", Date.now());

  const img = new Image();
  img.src = SCRIPT_POST + "?" + params.toString();
}
</script>
</body>
</html>
